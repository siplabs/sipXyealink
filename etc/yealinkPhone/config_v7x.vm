#set($serial = "$phone.SerialNumber")
#set($maxLineCount = $phone.MaxLineCount)
#set($signatureL1 = '####################################################')
#set($signatureL2 = '##         MAC-Oriented CFG File                  ##')
#set($signatureL3 = '####################################################')
#set($signatureL4 = '#!version:1.0.0.1')
#set($signatureL5 = '#File header "#!version:1.0.0.1" cannot be edited or deleted.##')
$signatureL4
$signatureL5
#macro (phonebooksSettings $setting)
#set ($selected = $setting.getTypedValue())
#set ($book_keys = $setting.getType().getEnums().keySet())
## Loop through each item
#set($pb = 0)
#foreach ($book_key in $book_keys)
#if (${selected.contains(${book_key})})
#set($pbId = 1 + ${selected.indexOf($book_key)})
remote_phonebook.data.${pbId}.url = $!{TFTPServer}${serial}-${pb}-directory.xml
remote_phonebook.data.${pbId}.name = $book_key
#set($pb = $pb + 1)
#end
#end
#set ($pbLast = ${selected.size()} + 1)
#foreach($pbId in [${pbLast}..5])
remote_phonebook.data.${pbId}.url = %NULL%
remote_phonebook.data.${pbId}.name = %NULL%
#end
#end
#macro (linesSetting $setting)
#set ($selected = $setting.getTypedValue())
#set ($keys = $setting.getType().getEnums().keySet())
## Loop through each item
#set($value = "")
#foreach ($key in $selected)
#if(${value} == "")
#set($value = ${key.substring(4)})
#else
#set($value = "$value,${key.substring(4)}")
#end
#end
${setting.profileName} = ${value}
#end

# Enable configured lines
#foreach ($line in $phone.lines)
#set ($lastLineID = $velocityCount)
#set ($SLP = $lastLineID - 1)
#set ($SLP = $SLP * 10)
#set ($SLP = $SLP + 5060)
# Line ${lastLineID} settings
#foreach ($group in $line.Settings.Values)
#${group.name}
#foreach ($setting in $group.Values)
#if(${setting.ProfileName} == "voice_mail.number")
${setting.ProfileName}.${lastLineID} = $!{setting.Value}
#elseif (${setting.ProfileName} == "label")
#elseif (${setting.ProfileName} == "user_name")
account.${lastLineID}.label = $!{setting.Value}
account.${lastLineID}.user_name = $!{setting.Value}
#else
#if(${setting.Value})
account.${lastLineID}.${setting.ProfileName} = $!{setting.Value}
#else
account.${lastLineID}.${setting.ProfileName} = %NULL%
#end
#end
#end
#end
account.${lastLineID}.sip_listen_port = ${SLP}
#end

#set ($lastLineID = $lastLineID + 1)
#if (${lastLineID}<${maxLineCount})
# Disable other lines
#foreach($L in [${lastLineID}..${maxLineCount}])
#set ($SLP = $L - 1)
#set ($SLP = $SLP * 10)
#set ($SLP = $SLP + 5060)
account.${L}.enable = 0
account.${L}.label = %NULL%
account.${L}.display_name = %NULL%
account.${L}.user_name = %NULL%
account.${L}.auth_name = %NULL%
account.${L}.password = %NULL%
account.${L}.sip_listen_port = ${SLP}
account.${L}.sip_server_host = %NULL%
account.${L}.sip_server_port = 5060
account.${L}.outbound_proxy_enable = 0
account.${L}.outbound_host = %NULL%
account.${L}.outbound_port = 5060
account.${L}.transport = 3
account.${L}.backup_outbound_host = %NULL%
account.${L}.backup_outbound_port = 5060
#end
#end

#Phone settings

#foreach ($group in $phone.Settings.Values)
#L1:${group.name}
#foreach ($subgroup in $group.Values)
#if(${subgroup.isLeaf()})
#if(${subgroup.Value})
${subgroup.profileName} = $!{subgroup.Value}
#else
${subgroup.profileName} = %NULL%
#end
#else
#foreach ($setting in $subgroup.Values)
#if(${setting.Value})
#if(${setting.name.matches("(.*(dial_out|incoming)_lines)|(dialplan.area_code.line_id)")})
#linesSetting($setting)
#elseif(${setting.name} == "_RemotePhonebooks")
#phonebooksSettings($setting)
#else
${setting.profileName} = $!{setting.Value}
#if (${setting.profileName} == "auto_provision.server.url")
#set ($TFTPServer = $!{setting.Value})
#end
#end
#else
#if(${subgroup.name} == "yealink-custom")
#else
${setting.profileName} = %NULL%
#end
#end
#end
#end
#end
#end
local_contact.data_photo_tar.url = $!{TFTPServer}yealink/Contacts/contacts.tar
favorite_setting.url = $!{TFTPServer}yealink/Contacts/favorites.xml
super_search.url = $!{TFTPServer}yealink/Contacts/search.xml
#foreach ($f in $phone.RingTones)
ringtone.url = $!{TFTPServer}yealink/RingTones/$!{f}
#end
#foreach ($f in $phone.WallPapers)
wallpaper_upload.url = $!{TFTPServer}yealink/WallPapers/$!{f}
#end
#foreach ($f in $phone.ScreenSavers)
screen_saver.pic.url = $!{TFTPServer}yealink/ScreenSavers/$!{f}
#end
#foreach ($f in $phone.Languages)
gui_lang.url = $!{TFTPServer}yealink/Languages/$!{f}
#end
